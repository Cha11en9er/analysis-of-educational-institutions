# ПРИМЕРЫ РАБОТЫ ПОИСКА TOPICS

Разбор работы алгоритма на реальных отзывах.

---

## ПРИМЕР 1: "Была лучшая школа города..."

**Текст отзыва:**
```
"Была лучшая школа города. Что будет теперь, посмотрим по результатам. 
Больше половины преподавателей ушли. Молодым специалистам следовало бы 
перенимать опыт и не сдавать позиций."
```

### Шаг 1: Приведение к нижнему регистру
```
review_lower = "была лучшая школа города. что будет теперь, посмотрим по результатам. 
больше половины преподавателей ушли. молодым специалистам следовало бы 
перенимать опыт и не сдавать позиций."
```

### Шаг 2: Поиск ключевых слов по категориям

#### Категория: `'учителя'`
**Ключевые слова:** `['учитель', 'преподаватель', 'педагог', 'классный', 'предмет', 'урок', 'обучение', 'преподавание']`

**Проверка каждого слова:**
- `'учитель'` → паттерн: `(?:^|[^а-яё])учитель(?=[^а-яё]|$)` → **НЕ НАЙДЕНО**
- `'преподаватель'` → паттерн: `(?:^|[^а-яё])преподаватель(?=[^а-яё]|$)` → **НАЙДЕНО!** (в слове "преподавателей")
- `'педагог'` → **НЕ НАЙДЕНО**
- `'классный'` → **НЕ НАЙДЕНО**
- и т.д.

**Результат:** `found_keywords = ['преподаватель']`

#### Категория: `'еда'`
**Ключевые слова:** `['еда', 'корм', 'столовая', 'питание', 'отрав', 'обед', 'завтрак', 'меню']`

**Проверка:** Все слова → **НЕ НАЙДЕНО**

**Результат:** `found_keywords = []` → тема не добавляется

#### Категория: `'администрация'`
**Ключевые слова:** `['директор', 'завуч', 'руководитель', 'администрация', 'управление']`

**Проверка:** Все слова → **НЕ НАЙДЕНО**

**Результат:** `found_keywords = []` → тема не добавляется

### Шаг 3: Извлечение контекста для найденной темы

**Для категории `'учителя'`:**

1. **Разбиение на предложения:**
   ```
   sentences = [
     "Была лучшая школа города",
     "Что будет теперь, посмотрим по результатам",
     "Больше половины преподавателей ушли",
     "Молодым специалистам следовало бы перенимать опыт и не сдавать позиций"
   ]
   ```

2. **Поиск релевантных предложений:**
   - Предложение 1: "Была лучшая школа города" → нет "преподаватель" → **пропускаем**
   - Предложение 2: "Что будет теперь..." → нет "преподаватель" → **пропускаем**
   - Предложение 3: "Больше половины преподавателей ушли" → **ЕСТЬ "преподавателей"** → **ДОБАВЛЯЕМ**
   - Предложение 4: "Молодым специалистам..." → нет "преподаватель" → **пропускаем**

3. **Результат:**
   ```
   relevant_sentences = ["Больше половины преподавателей ушли"]
   context_text = "Больше половины преподавателей ушли"
   ```

### Шаг 4: Анализ тональности

**Контекст:** `"Больше половины преподавателей ушли"`

#### 4.1. Базовый анализ (`analyze_text_sentiment`):

**Проверка положительных слов:**
- `'хорош'` → нет
- `'отличн'` → нет
- `'прекрасн'` → нет
- и т.д.
- **positive_score = 0**

**Проверка отрицательных слов:**
- `'плох'` → нет
- `'ужасн'` → нет
- `'проблем'` → нет
- и т.д.
- **negative_score = 0**

**Результат:** `sentiment = 0` (нейтральный)

#### 4.2. Дополнительные индикаторы:

**Проверка положительных индикаторов:**
- `'хорош'` → нет
- `'отличн'` → нет
- `'прекрасн'` → нет
- и т.д.
- **positive_count = 0**

**Проверка отрицательных индикаторов:**
- `'плох'` → нет
- `'ужасн'` → нет
- `'проблем'` → нет
- и т.д.
- **negative_count = 0**

#### 4.3. Финальное решение:

```python
if sentiment > 0 or (sentiment == 0 and positive_count > negative_count):
    # sentiment == 0, positive_count == 0, negative_count == 0
    # Условие НЕ выполняется
elif sentiment < 0 or (sentiment == 0 and negative_count > positive_count):
    # sentiment == 0, negative_count == 0, positive_count == 0
    # Условие НЕ выполняется
else:
    topics[category] = "pos"  # По умолчанию положительный
```

**ПРОБЛЕМА:** Фраза "преподавателей ушли" явно негативная, но алгоритм не видит этого, потому что:
- Нет явных слов "плохо", "ужасно"
- Слово "ушли" не входит в список отрицательных индикаторов

**Результат:** `topics['учителя'] = "pos"` ❌ (неправильно, должно быть "neg")

---

## ПРИМЕР 2: "На мой, субъективный, вгляд..."

**Текст отзыва:**
```
"На мой, субъективный, вгляд - это школа не для всех. Для моей дочери она 
очень даже подошла. После ЛМИ учиться оказалось не так уж и сложно. Уроков 
задавали много, но дочь справлялась нормально. До ночи не сидели. Очень 
благодарна школе и учителям за полученные дочерью знания!!! За всё время 
обучения репетитор был только по английскому, и то для себя, захотелось 
большего прогресса."
```

### Шаг 1: Поиск ключевых слов

#### Категория: `'учителя'`
**Ключевые слова:** `['учитель', 'преподаватель', 'педагог', 'классный', 'предмет', 'урок', 'обучение', 'преподавание']`

**Проверка:**
- `'урок'` → **НАЙДЕНО!** (в слове "Уроков")
- `'обучение'` → **НАЙДЕНО!** (в слове "обучения")
- `'учитель'` → **НАЙДЕНО!** (в слове "учителям")

**Результат:** `found_keywords = ['урок', 'обучение', 'учитель']`

### Шаг 2: Извлечение контекста

**Разбиение на предложения:**
```
sentences = [
  "На мой, субъективный, вгляд - это школа не для всех",
  "Для моей дочери она очень даже подошла",
  "После ЛМИ учиться оказалось не так уж и сложно",
  "Уроков задавали много, но дочь справлялась нормально",
  "До ночи не сидели",
  "Очень благодарна школе и учителям за полученные дочерью знания!!!",
  "За всё время обучения репетитор был только по английскому, и то для себя, захотелось большего прогресса"
]
```

**Релевантные предложения (содержат ключевые слова):**
- "Уроков задавали много, но дочь справлялась нормально" → содержит "урок"
- "Очень благодарна школе и учителям за полученные дочерью знания!!!" → содержит "учитель"
- "За всё время обучения репетитор был только по английскому..." → содержит "обучение"

**Результат:**
```
context_text = "Уроков задавали много, но дочь справлялась нормально. 
Очень благодарна школе и учителям за полученные дочерью знания!!! 
За всё время обучения репетитор был только по английскому, и то для себя,        захотелось большего прогресса"
```

### Шаг 3: Анализ тональности

**Контекст:** `"Уроков задавали много... Очень благодарна школе и учителям... За всё время обучения..."`

#### 3.1. Базовый анализ:

**Положительные слова:**
- `'благодар'` → **ЕСТЬ!** (в слове "благодарна")
- `'хорош'` → нет
- `'отличн'` → нет
- и т.д.
- **positive_score = 1**

**Отрицательные слова:**
- Все проверки → нет
- **negative_score = 0**

**Результат:** `sentiment = 1` (положительный)

#### 3.2. Дополнительные индикаторы:

**Положительные индикаторы:**
- `'благодар'` → **ЕСТЬ!**
- `'хорош'` → нет
- и т.д.
- **positive_count = 1**

**Отрицательные индикаторы:**
- Все проверки → нет
- **negative_count = 0**

#### 3.3. Финальное решение:

```python
if sentiment > 0 or (sentiment == 0 and positive_count > negative_count):
    # sentiment = 1 > 0 → УСЛОВИЕ ВЫПОЛНЯЕТСЯ
    topics['учителя'] = "pos"
```

**Результат:** `topics['учителя'] = "pos"` ✅ (правильно)

---

## ПРИМЕР 3: "Учусь здесь с 6-го класса..."

**Текст отзыва:**
```
"Учусь здесь с 6-го класса, сейчас в десятом. Ни на что бы не променяла 
время, проведенное здесь!\nУчителя и персонал замечательные, а директор - 
вообще вышка!\nКогда контактирую с ребятами моего возраста из других школ, 
сразу замечаю разницу в качестве обучения."
```

### Шаг 1: Поиск ключевых слов

#### Категория: `'учителя'`
**Проверка:**
- `'учитель'` → **НАЙДЕНО!** (в слове "Учителя")
- `'обучение'` → **НАЙДЕНО!** (в слове "обучения")

**Результат:** `found_keywords = ['учитель', 'обучение']`

#### Категория: `'администрация'`
**Проверка:**
- `'директор'` → **НАЙДЕНО!** (в слове "директор")

**Результат:** `found_keywords = ['директор']`

### Шаг 2: Извлечение контекста

**Для категории `'учителя'`:**

**Релевантные предложения:**
- "Учителя и персонал замечательные, а директор - вообще вышка!" → содержит "учитель"
- "Когда контактирую с ребятами моего возраста из других школ, сразу замечаю разницу в качестве обучения" → содержит "обучение"

**Результат:**
```
context_text = "Учителя и персонал замечательные, а директор - вообще вышка! 
Когда контактирую с ребятами моего возраста из других школ, сразу замечаю разницу в качестве обучения"
```

**Для категории `'администрация'`:**

**Релевантные предложение:**
- "Учителя и персонал замечательные, а директор - вообще вышка!" → содержит "директор"

**Результат:**
```
context_text = "Учителя и персонал замечательные, а директор - вообще вышка!"
```

### Шаг 3: Анализ тональности

**Для категории `'учителя'`:**

**Контекст:** `"Учителя и персонал замечательные... замечаю разницу в качестве обучения"`

**Положительные слова:**
- `'замечательн'` → **ЕСТЬ!** (в слове "замечательные")
- `'замечаю'` → **ЕСТЬ!** (в слове "замечаю")
- **positive_score = 2**

**Отрицательные слова:**
- Все проверки → нет
- **negative_score = 0**

**Результат:** `sentiment = 1` (положительный)

**Дополнительные индикаторы:**
- `'замечательн'` → **ЕСТЬ!**
- **positive_count = 1**
- **negative_count = 0**

**Финальное решение:**
```python
if sentiment > 0:  # sentiment = 1 > 0
    topics['учителя'] = "pos"
```

**Результат:** `topics['учителя'] = "pos"` ✅ (правильно)

**Для категории `'администрация'`:**

**Контекст:** `"Учителя и персонал замечательные, а директор - вообще вышка!"`

**Положительные слова:**
- `'замечательн'` → **ЕСТЬ!**
- **positive_score = 1**

**Отрицательные слова:**
- Все проверки → нет
- **negative_score = 0**

**Результат:** `sentiment = 1` (положительный)

**Финальное решение:**
```python
if sentiment > 0:  # sentiment = 1 > 0
    topics['администрация'] = "pos"
```

**Результат:** `topics['администрация'] = "pos"` ✅ (правильно)

---

## ПРИМЕР 4: "Учусь в этом прекрасном заведении..."

**Текст отзыва:**
```
"Учусь в этом прекрасном заведении второй год и хочу поделиться своим отзывом. 
Преподаватели учат получать знания, а не гнаться за оценками.\nБольшое внимание 
здесь уделяется на дисциплину.\nВ каждом классе есть своя дружная уютная атмосфера. 
Здесь ты можешь найти команду единомышленников. Я видел много отзывов на счёт того, 
что здесь нет хороших условий для обучения и т. д., но хочу опровергнуть это, т.к. 
недавно школа перешла на областной уровень, теперь здесь появилось новое оборудование. 
В каждом кабинете есть проектор. Хочу сказать ещё про учителей. В ФТЛ много молодых 
перспективных учителей, которым гораздо проще найти общий язык с учениками."
```

### Шаг 1: Поиск ключевых слов

#### Категория: `'учителя'`
**Проверка:**
- `'преподаватель'` → **НАЙДЕНО!** (в слове "Преподаватели")
- `'учитель'` → **НАЙДЕНО!** (в слове "учителей")
- `'обучение'` → **НАЙДЕНО!** (в слове "обучения")

**Результат:** `found_keywords = ['преподаватель', 'учитель', 'обучение']`

#### Категория: `'инфраструктура'`
**Ключевые слова:** `['парковк', 'место', 'пространств', 'класс', 'спортзал', 'бассейн', 'стадион', 'площадка']`

**Проверка:**
- `'класс'` → **НАЙДЕНО!** (в слове "классе")
- `'место'` → **НАЙДЕНО!** (в слове "место")

**Результат:** `found_keywords = ['класс', 'место']`

**ПРОБЛЕМА:** Слово "место" слишком общее и может находиться в разных контекстах!

### Шаг 2: Извлечение контекста

**Для категории `'учителя'`:**

**Релевантные предложения:**
- "Преподаватели учат получать знания, а не гнаться за оценками" → содержит "преподаватель"
- "что здесь нет хороших условий для обучения и т. д." → содержит "обучение"
- "Хочу сказать ещё про учителей. В ФТЛ много молодых перспективных учителей..." → содержит "учитель"

**Результат:**
```
context_text = "Преподаватели учат получать знания, а не гнаться за оценками. 
Я видел много отзывов на счёт того, что здесь нет хороших условий для обучения и т. д., 
но хочу опровергнуть это... Хочу сказать ещё про учителей. В ФТЛ много молодых 
перспективных учителей, которым гораздо проще найти общий язык с учениками"
```

**Для категории `'инфраструктура'`:**

**Релевантные предложения:**
- "В каждом классе есть своя дружная уютная атмосфера" → содержит "класс"
- "недавно школа перешла на областной уровень, теперь здесь появилось новое оборудование" → содержит "место" (в слове "оборудование"? Нет, но паттерн может найти "место" в другом месте)

**ПРОБЛЕМА:** Слово "место" может находиться в контексте, не связанном с инфраструктурой!

### Шаг 3: Анализ тональности

**Для категории `'учителя'`:**

**Контекст:** `"Преподаватели учат получать знания... нет хороших условий для обучения... много молодых перспективных учителей"`

**Положительные слова:**
- `'хорош'` → **ЕСТЬ!** (в слове "хороших", но в контексте "нет хороших" - это отрицание!)
- `'прекрасн'` → нет в контексте
- и т.д.

**ПРОБЛЕМА:** Алгоритм видит "хороших" и считает это положительным, но не учитывает "нет" перед ним!

**Результат:** `sentiment = 1` (положительный) - но это может быть неправильно из-за "нет хороших"

**Финальное решение:**
```python
if sentiment > 0:
    topics['учителя'] = "pos"
```

**Результат:** `topics['учителя'] = "pos"` ✅ (в целом правильно, но есть нюанс с "нет хороших")

---

## ИТОГОВЫЕ ПРОБЛЕМЫ АЛГОРИТМА:

### 1. **Не учитываются отрицания**
- "нет хороших условий" → алгоритм видит "хороших" и считает положительным
- "преподавателей ушли" → не видит негатив, потому что "ушли" не в списке отрицательных слов

### 2. **Слишком общие ключевые слова**
- "место", "пространств" → находят в разных контекстах
- "класс" → может быть "класс" (помещение) или "класс" (группа учеников)

### 3. **Плохая работа с русским языком**
- Паттерн `\b` не работает с русскими словами
- Не учитываются падежи и склонения

### 4. **Простой подсчет слов**
- Не учитывается порядок слов
- Не учитывается контекст вокруг ключевых слов
- "не хороший" может считаться положительным

### 5. **Ограниченные словари**
- Много слов не входят в списки (например, "ушли", "променяла")
- Нет учета синонимов и вариаций

---

## РЕКОМЕНДАЦИИ ДЛЯ УЛУЧШЕНИЯ:

1. **Добавить проверку отрицаний:**
   - Искать паттерны типа "не [положительное_слово]"
   - Учитывать контекст вокруг ключевых слов

2. **Уточнить ключевые слова:**
   - Убрать слишком общие слова ("место", "пространств")
   - Добавить более специфичные термины

3. **Улучшить анализ тональности:**
   - Учитывать порядок слов
   - Анализировать контекст вокруг ключевых слов (окно ±5 слов)

4. **Расширить словари:**
   - Добавить больше синонимов
   - Учесть вариации слов (падежи, склонения)

5. **Добавить проверку контекста:**
   - Если ключевое слово найдено, проверять, действительно ли оно относится к теме
   - Например, "класс" в контексте "в классе есть" = инфраструктура, а "классный руководитель" = учителя

